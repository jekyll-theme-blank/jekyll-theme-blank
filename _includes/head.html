{%- if page.layout == 'post-listing-page' -%}
  {%- assign is_post_listing_page = true -%}
{%- endif -%}

{%- if page.layout == 'plain-text-post' -%}
  {%- assign is_plain_text_post = true -%}
{%- endif -%}

{%- assign charset = page.charset | default: site.charset -%}
{%- comment -%}
  # If `charset` is falsy (i.e., `nil` or `false`), assigns the default encoding. If it is an empty string, leaves it as is. (In that case, no `<meta charset="...">` tag is output.)
{%- endcomment -%}
{%- unless charset -%}
  {%- assign charset = 'utf-8' -%}
{%- endunless -%}

{%- assign color_scheme = page.color_scheme | default: site.color_scheme -%}

{%- assign viewport = page.viewport | default: site.viewport -%}
{%- unless viewport -%}
  {%- assign viewport = 'width=device-width, initial-scale=1' -%}
{%- endunless -%}

{%- assign canonical_url = page.url | absolute_url -%}

{%- comment -%}
  # Converts all "+" to "%2B" so that they become "+" after decoding. ("+" is not encoded in `canonical_url`, while `url_decode` decodes it to a space.)
{%- endcomment -%}
{%- assign decoded_canonical_url = canonical_url | replace: '+', '%2B' | url_decode -%}

{%- assign license_url = page.license_url | default: site.license_url -%}

{%- if charset != "" %}
    <meta charset="{{- charset -}}">
{%- endif -%}

{%- if color_scheme and color_scheme != "" %}
    <meta name="color-scheme" content="{{- color_scheme -}}">
{%- endif -%}

{%- if viewport != "" %}
    <meta name="viewport" content="{{- viewport -}}">
{%- endif %}
    <title>
      {%- if is_post_listing_page -%}
        {{- site.title -}}
      {%- elsif is_plain_text_post -%}
        {{- decoded_canonical_url -}}
      {%- else -%}
        {{- page.title -}}
      {%- endif -%}
    </title>
    <link rel="canonical" href="{{- canonical_url -}}">

{%- if license_url and license_url != "" %}
    <link rel="license" href="{{- license_url -}}">
{%- endif -%}

{%- if is_plain_text_post %}
    <style>{% include plain-text-post.css %}    </style>
{%- endif %}
